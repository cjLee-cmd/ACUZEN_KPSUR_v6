<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ê³ ì„œ ëª©ë¡ - KPSUR AGENT | ACUZEN AI</title>
    <link rel="stylesheet" href="../css/styles/globals.css">
    <link rel="stylesheet" href="../css/styles/layout.css">
    <style>
        /* ë‹¤í¬ëª¨ë“œ ë³€ìˆ˜ */
        :root {
            --page-bg: #F5F7FA;
            --card-bg: white;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --text-primary: #374151;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --border-color: #E5E7EB;
            --border-light: #F3F4F6;
            --table-header-bg: #F9FAFB;
            --input-bg: white;
        }

        [data-theme="dark"] {
            --page-bg: #1e293b;
            --card-bg: #1e293b;
            --card-shadow: none;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --border-light: #334155;
            --table-header-bg: #334155;
            --input-bg: #334155;
        }

        /* ë‹¤í¬ëª¨ë“œ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ */
        [data-theme="dark"] .filter-section,
        [data-theme="dark"] .table-container {
            background: var(--card-bg);
            box-shadow: none;
            border: 1px solid var(--border-color);
        }

        [data-theme="dark"] .filter-input,
        [data-theme="dark"] .filter-select {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        [data-theme="dark"] .filter-chip {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-secondary);
        }

        [data-theme="dark"] .filter-chip:hover {
            border-color: #25739B;
            color: #60a5fa;
        }

        [data-theme="dark"] .btn-reset {
            background: var(--border-color);
            color: var(--text-secondary);
        }

        [data-theme="dark"] .view-toggle {
            background: var(--border-color);
        }

        [data-theme="dark"] .view-btn {
            color: var(--text-secondary);
        }

        [data-theme="dark"] .view-btn.active {
            background: var(--input-bg);
            color: var(--text-primary);
        }

        [data-theme="dark"] .reports-table th {
            background: var(--table-header-bg);
            color: var(--text-secondary);
            border-bottom-color: var(--border-color);
        }

        [data-theme="dark"] .reports-table td {
            color: var(--text-primary);
            border-bottom-color: var(--border-color);
        }

        [data-theme="dark"] .reports-table tr:hover {
            background: rgba(37, 115, 155, 0.1);
        }

        [data-theme="dark"] .page-btn {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-secondary);
        }

        [data-theme="dark"] .page-btn:hover:not(:disabled) {
            border-color: #60a5fa;
            color: #60a5fa;
        }

        [data-theme="dark"] .pagination {
            border-top-color: var(--border-color);
        }

        [data-theme="dark"] .table-header {
            border-bottom-color: var(--border-color);
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
        }

        .page-title-section h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .page-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .btn-primary {
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(135deg, #25739B 0%, #369EE1 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(37, 115, 155, 0.3);
        }

        /* í•„í„° ì„¹ì…˜ */
        .filter-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 1px 3px var(--card-shadow);
        }

        .filter-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .filter-input, .filter-select {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .filter-input:focus, .filter-select:focus {
            border-color: #25739B;
            outline: none;
        }

        .filter-chips {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-secondary);
        }

        .filter-chip:hover {
            border-color: #25739B;
            color: #25739B;
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #25739B 0%, #369EE1 100%);
            color: white;
            border-color: transparent;
        }

        .filter-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .btn-filter {
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-apply {
            background: #25739B;
            color: white;
        }

        .btn-reset {
            background: var(--border-color);
            color: var(--text-secondary);
        }

        /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ */
        .table-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 1px 3px var(--card-shadow);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
        }

        .table-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-count {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .table-actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: var(--border-light);
            padding: 4px;
            border-radius: 6px;
        }

        .view-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .view-btn.active {
            background: var(--card-bg);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            color: var(--text-primary);
        }

        /* í…Œì´ë¸” */
        .reports-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reports-table th {
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--table-header-bg);
            position: sticky;
            top: 0;
        }

        .reports-table th.sortable {
            cursor: pointer;
            user-select: none;
        }

        .reports-table th.sortable:hover {
            color: #25739B;
        }

        .sort-icon {
            margin-left: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .sort-icon.active {
            color: #25739B;
        }

        .reports-table td {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
            font-size: 13px;
            color: var(--text-primary);
        }

        .reports-table tr:hover {
            background: rgba(37, 115, 155, 0.02);
        }

        .report-name {
            font-weight: 600;
            color: #25739B;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .report-name:hover {
            text-decoration: underline;
        }

        .urgent-badge {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #EF4444;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.draft {
            background: rgba(156, 163, 175, 0.1);
            color: #6B7280;
        }

        .status-badge.in-progress {
            background: rgba(59, 130, 246, 0.1);
            color: #3B82F6;
        }

        .status-badge.review {
            background: rgba(245, 158, 11, 0.1);
            color: #F59E0B;
        }

        .status-badge.qc {
            background: rgba(168, 85, 247, 0.1);
            color: #A855F7;
        }

        .status-badge.completed {
            background: rgba(16, 185, 129, 0.1);
            color: #10B981;
        }

        .stage-text {
            font-size: 11px;
            color: var(--text-muted);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .action-btn {
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: rgba(37, 115, 155, 0.1);
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
        }

        .pagination-info {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .pagination-controls {
            display: flex;
            gap: var(--spacing-sm);
        }

        .page-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .page-btn:hover:not(:disabled) {
            border-color: #25739B;
            color: #25739B;
        }

        .page-btn.active {
            background: #25739B;
            color: white;
            border-color: #25739B;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
            }

            .reports-table {
                min-width: 800px;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-text">KPSUR AGENT</span>
                    <span class="logo-subtitle">ACUZEN AI | v.0.1.2.</span>
                </div>
                <span class="deployment-badge test">í…ŒìŠ¤íŠ¸</span>
            </div>

            <div class="header-center">
                <div class="breadcrumb">
                    <span class="breadcrumb-item" onclick="navigateTo('P10_Dashboard.html')" style="cursor: pointer;">ëŒ€ì‹œë³´ë“œ</span>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item active">ë³´ê³ ì„œ ëª©ë¡</span>
                </div>
            </div>

            <div class="header-right">
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
                    <span class="icon-sun">â˜€ï¸</span>
                    <span class="icon-moon">ğŸŒ™</span>
                </button>
                <div class="user-menu">
                    <div class="user-avatar">ì‚¬</div>
                    <div class="user-info">
                        <div class="user-name">ì‚¬ìš©ì</div>
                        <div class="user-role">Author</div>
                        <div class="user-position"></div>
                    </div>
                    <button class="user-menu-toggle">â–¼</button>
                </div>
            </div>
        </header>

        <!-- Content with Sidebar -->
        <div class="app-content">
            <!-- Main Content -->
            <main class="main-content">
                <div class="page-container">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="page-title-section">
                            <h1>ë³´ê³ ì„œ ëª©ë¡</h1>
                            <p class="page-subtitle">ì „ì²´ PSUR ë³´ê³ ì„œë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                        </div>

                        <div class="header-actions">
                            <button class="btn-primary" onclick="navigateTo('P13_NewReport.html')">
                                <span>â•</span>
                                <span>ìƒˆ ë³´ê³ ì„œ ìƒì„±</span>
                            </button>
                        </div>
                    </div>

                    <!-- í•„í„° ì„¹ì…˜ -->
                    <div class="filter-section">
                        <div class="filter-row" style="margin-bottom: var(--spacing-md);">
                            <div class="filter-group">
                                <label class="filter-label">ê²€ìƒ‰</label>
                                <input
                                    type="text"
                                    class="filter-input"
                                    placeholder="ë³´ê³ ì„œëª…, ì„±ë¶„ëª… ê²€ìƒ‰..."
                                    id="searchInput"
                                >
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">ì‘ì„±ì</label>
                                <select class="filter-select" id="authorFilter">
                                    <option value="">ì „ì²´</option>
                                    <option value="ê¹€ì² ìˆ˜">ê¹€ì² ìˆ˜</option>
                                    <option value="ì´ì˜í¬">ì´ì˜í¬</option>
                                    <option value="ë°•ë¯¼ìˆ˜">ë°•ë¯¼ìˆ˜</option>
                                    <option value="ìµœì§€ì˜">ìµœì§€ì˜</option>
                                    <option value="ì •ìˆ˜ë¹ˆ">ì •ìˆ˜ë¹ˆ</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">ê¸°ê°„</label>
                                <select class="filter-select" id="periodFilter">
                                    <option value="">ì „ì²´</option>
                                    <option value="today">ì˜¤ëŠ˜</option>
                                    <option value="week">ìµœê·¼ 1ì£¼ì¼</option>
                                    <option value="month">ìµœê·¼ 1ê°œì›”</option>
                                    <option value="quarter">ìµœê·¼ 3ê°œì›”</option>
                                </select>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">ë‹¨ê³„</label>
                                <select class="filter-select" id="stageFilter">
                                    <option value="">ì „ì²´</option>
                                    <option value="2">Stage 2 - ë³´ê³ ì„œ ìƒíƒœ</option>
                                    <option value="3">Stage 3 - íŒŒì¼ ì—…ë¡œë“œ</option>
                                    <option value="4">Stage 4 - MD ë³€í™˜</option>
                                    <option value="5">Stage 5 - ë°ì´í„° ì¶”ì¶œ</option>
                                    <option value="6">Stage 6 - í…œí”Œë¦¿ ì‘ì„±</option>
                                    <option value="7">Stage 7 - ë¦¬ë·°</option>
                                    <option value="8">Stage 8 - QC ê²€ì¦</option>
                                    <option value="9">Stage 9 - ìµœì¢… ì¶œë ¥</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-row" style="margin-bottom: var(--spacing-md);">
                            <div class="filter-group">
                                <label class="filter-label">ìƒíƒœ</label>
                                <div class="filter-chips">
                                    <div class="filter-chip active" data-status="">ì „ì²´</div>
                                    <div class="filter-chip" data-status="draft">ì„ì‹œì €ì¥</div>
                                    <div class="filter-chip" data-status="in-progress">ì§„í–‰ì¤‘</div>
                                    <div class="filter-chip" data-status="review">ë¦¬ë·°ì¤‘</div>
                                    <div class="filter-chip" data-status="qc">QCëŒ€ê¸°</div>
                                    <div class="filter-chip" data-status="completed">ì™„ë£Œ</div>
                                </div>
                            </div>
                        </div>

                        <div class="filter-row">
                            <div class="filter-actions">
                                <button class="btn-filter btn-apply" onclick="applyFilters()">ì ìš©</button>
                                <button class="btn-filter btn-reset" onclick="resetFilters()">ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    </div>

                    <!-- í…Œì´ë¸” -->
                    <div class="table-container">
                        <div class="table-header">
                            <div>
                                <div class="table-title">ì „ì²´ ë³´ê³ ì„œ</div>
                                <div class="table-count" id="tableCount">ë¡œë”© ì¤‘...</div>
                            </div>

                            <div class="table-actions">
                                <div class="view-toggle">
                                    <button class="view-btn active">ëª©ë¡</button>
                                    <button class="view-btn">ì¹´ë“œ</button>
                                </div>
                            </div>
                        </div>

                        <table class="reports-table">
                            <thead>
                                <tr>
                                    <th class="sortable" onclick="sortTable('name')">
                                        ë³´ê³ ì„œëª…
                                        <span class="sort-icon">â†•</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('ingredient')">
                                        ì„±ë¶„ëª…
                                        <span class="sort-icon">â†•</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('stage')">
                                        ë‹¨ê³„
                                        <span class="sort-icon">â†•</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('status')">
                                        ìƒíƒœ
                                        <span class="sort-icon">â†•</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('author')">
                                        ì‘ì„±ì
                                        <span class="sort-icon">â†•</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('date')">
                                        ìˆ˜ì •ì¼
                                        <span class="sort-icon active">â†“</span>
                                    </th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="reportsTableBody">
                                <!-- ìƒ˜í”Œ ë°ì´í„° -->
                            </tbody>
                        </table>

                        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                        <div class="pagination">
                            <div class="pagination-info">
                                <span id="paginationInfo">ë¡œë”© ì¤‘...</span>
                            </div>

                            <div class="pagination-controls">
                                <button class="page-btn" disabled>â€¹ ì´ì „</button>
                                <button class="page-btn active">1</button>
                                <button class="page-btn">2</button>
                                <button class="page-btn">ë‹¤ìŒ â€º</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Workflow Sidebar (Right) -->
            <aside class="workflow-sidebar">
                <div class="workflow-header">
                    <h3>ì§„í–‰ ìƒí™©</h3>
                    <div class="workflow-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">ë³´ê³ ì„œ ëª©ë¡</div>
                    </div>
                </div>

                <div class="workflow-stages">
                    <div class="workflow-stage completed">
                        <div class="stage-icon">ğŸ”</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 1</div>
                            <div class="stage-label">ë¡œê·¸ì¸</div>
                        </div>
                        <div class="stage-status">âœ“</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">ğŸ“‹</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 2</div>
                            <div class="stage-label">ë³´ê³ ì„œ ìƒíƒœ</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">ğŸ“¤</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 3</div>
                            <div class="stage-label">íŒŒì¼ ì—…ë¡œë“œ</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">ğŸ”„</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 4</div>
                            <div class="stage-label">MD ë³€í™˜</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">âš™ï¸</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 5</div>
                            <div class="stage-label">ë°ì´í„° ì¶”ì¶œ</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">ğŸ“„</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 6</div>
                            <div class="stage-label">í…œí”Œë¦¿ ì‘ì„±</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">âœï¸</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 7</div>
                            <div class="stage-label">ë¦¬ë·°</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">âœ…</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 8</div>
                            <div class="stage-label">QC ê²€ì¦</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>

                    <div class="workflow-stage pending">
                        <div class="stage-icon">ğŸ“¤</div>
                        <div class="stage-info">
                            <div class="stage-name">Stage 9</div>
                            <div class="stage-label">ìµœì¢… ì¶œë ¥</div>
                        </div>
                        <div class="stage-status">â—‹</div>
                    </div>
                </div>

                <div class="workflow-footer">
                    <div class="medical-badge">ì˜ë£Œìš© AI ì†Œí”„íŠ¸ì›¨ì–´</div>
                </div>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                Copyright. Power Solution., Inc. 2026.
            </div>
        </footer>
    </div>

    <!-- Dark Mode Script -->
    <script>
        // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™” (í˜ì´ì§€ ë¡œë“œ ì¦‰ì‹œ)
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        // ë‹¤í¬ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }
    </script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- JavaScript -->
    <!-- Note: AppLayout.js removed - it uses ES6 imports but isn't needed here -->
    <script src="../utils/layout-helper.js"></script>
    <script>
        // ë³´ê³ ì„œ ë°ì´í„° (DBì—ì„œ ë¡œë“œ)
        let allReports = [];
        let currentReports = [];
        let isLoading = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        async function initializePage() {
            // Check if globals are loaded (supabaseClient, authManager)
            if (!window.__GLOBALS_LOADED__ || !window.supabaseClient || !window.authManager) {
                setTimeout(initializePage, 50);
                return;
            }

            // Use window globals (loaded after this script)
            const supabaseClient = window.supabaseClient;
            const authManager = window.authManager;

            const session = window.loadSessionData ? loadSessionData() : null;
            if (session) {
                document.querySelector('.user-name').textContent = session.userName;
                document.querySelector('.user-role').textContent = session.userRole;
                document.querySelector('.user-position').textContent = session.userPosition || '';
                document.querySelector('.user-avatar').textContent = session.userName.charAt(0);
            }

            if (window.setupUserMenu) setupUserMenu();
            setupFilterChips();

            // DBì—ì„œ ë³´ê³ ì„œ ëª©ë¡ ë¡œë“œ
            await loadReportsFromDB();

            // URL íŒŒë¼ë¯¸í„°ì—ì„œ í•„í„° í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            const filter = urlParams.get('filter');
            if (filter && filter !== 'all') {
                const chip = document.querySelector(`[data-status="${filter}"]`);
                if (chip) {
                    document.querySelector('.filter-chip.active').classList.remove('active');
                    chip.classList.add('active');
                    applyFilters();
                }
            }
        }

        // DBì—ì„œ ë³´ê³ ì„œ ëª©ë¡ ë¡œë“œ
        async function loadReportsFromDB() {
            try {
                isLoading = true;
                showLoadingState();

                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (use window globals)
                const currentUser = window.authManager?.getCurrentUser();
                const userId = currentUser?.id;

                if (!userId) {
                    console.warn('âš ï¸ No user logged in, showing empty list');
                    allReports = [];
                    currentReports = [];
                    renderReports();
                    return;
                }

                // DBì—ì„œ ë³´ê³ ì„œ ì¡°íšŒ (use window globals)
                const result = await window.supabaseClient.getReports(userId);

                if (result.success) {
                    // DB ë°ì´í„°ë¥¼ UI í¬ë§·ìœ¼ë¡œ ë³€í™˜
                    allReports = result.reports.map(dbReport => {
                        const userInputs = dbReport.user_inputs || {};
                        return {
                            id: dbReport.id,
                            name: dbReport.report_name || 'ì œëª© ì—†ìŒ',
                            ingredient: userInputs.CS0_ì„±ë¶„ëª… || '-',
                            stage: dbReport.current_stage || 2,
                            status: mapStatusToUI(dbReport.status),
                            author: dbReport.created_by_name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                            date: formatDate(dbReport.updated_at || dbReport.created_at),
                            urgent: isUrgent(dbReport)
                        };
                    });

                    currentReports = [...allReports];
                    console.log(`âœ… Loaded ${allReports.length} reports from DB`);
                } else {
                    console.error('âŒ Failed to load reports:', result.error);
                    if (window.showToast) showToast('ë³´ê³ ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨', 'error');
                }

            } catch (error) {
                console.error('âŒ loadReportsFromDB error:', error);
                if (window.showToast) showToast('DB ì—°ê²° ì˜¤ë¥˜', 'error');
            } finally {
                isLoading = false;
                renderReports();
            }
        }

        // DB statusë¥¼ UI statusë¡œ ë§¤í•‘
        function mapStatusToUI(dbStatus) {
            const statusMap = {
                'Draft': 'draft',
                'InProgress': 'in-progress',
                'Review': 'review',
                'QC': 'qc',
                'Completed': 'completed'
            };
            return statusMap[dbStatus] || 'draft';
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(isoDate) {
            if (!isoDate) return '-';
            const date = new Date(isoDate);
            return date.toISOString().split('T')[0];
        }

        // ê¸´ê¸‰ ì—¬ë¶€ íŒë‹¨ (Stage 7-8ì´ê³  ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ê²½ìš°)
        function isUrgent(report) {
            const stage = report.current_stage || 0;
            if (stage < 7 || stage > 8) return false;

            const updatedAt = new Date(report.updated_at || report.created_at);
            const daysSinceUpdate = (Date.now() - updatedAt.getTime()) / (1000 * 60 * 60 * 24);
            return daysSinceUpdate <= 3;
        }

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoadingState() {
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div>ğŸ”„ ë³´ê³ ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </td>
                </tr>
            `;
        }

        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }

        function setupFilterChips() {
            const chips = document.querySelectorAll('.filter-chip');
            chips.forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelector('.filter-chip.active').classList.remove('active');
                    chip.classList.add('active');
                    applyFilters();
                });
            });
        }

        function renderReports() {
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '';

            if (currentReports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="margin-bottom: 12px;">ğŸ“­ ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                            <button class="btn-primary" onclick="window.navigateTo('P13_NewReport.html')">
                                â• ìƒˆ ë³´ê³ ì„œ ìƒì„±
                            </button>
                        </td>
                    </tr>
                `;
                updateTableCount();
                return;
            }

            currentReports.forEach(report => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div class="report-name" onclick="window.navigateTo('P12_ReportDetail.html?reportId=${report.id}')">
                            ${report.urgent ? '<span class="urgent-badge"></span>' : ''}
                            ${report.name}
                        </div>
                    </td>
                    <td>${report.ingredient}</td>
                    <td><span class="stage-text">Stage ${report.stage} - ${getStageName(report.stage)}</span></td>
                    <td><span class="status-badge ${report.status}">${getStatusText(report.status)}</span></td>
                    <td>${report.author}</td>
                    <td>${report.date}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="window.viewReport('${report.id}')" title="ë³´ê¸°">ğŸ‘ï¸</button>
                            <button class="action-btn" onclick="window.editReport('${report.id}')" title="í¸ì§‘">âœï¸</button>
                            <button class="action-btn" onclick="window.deleteReport('${report.id}')" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            updateTableCount();
        }

        function getStageName(stage) {
            const stages = {
                2: 'ë³´ê³ ì„œ ìƒíƒœ',
                3: 'íŒŒì¼ ì—…ë¡œë“œ',
                4: 'MD ë³€í™˜',
                5: 'ë°ì´í„° ì¶”ì¶œ',
                6: 'í…œí”Œë¦¿ ì‘ì„±',
                7: 'ë¦¬ë·°',
                8: 'QC ê²€ì¦',
                9: 'ìµœì¢… ì¶œë ¥'
            };
            return stages[stage] || '';
        }

        function getStatusText(status) {
            const texts = {
                'draft': 'ì„ì‹œì €ì¥',
                'in-progress': 'ì§„í–‰ì¤‘',
                'review': 'ë¦¬ë·°ì¤‘',
                'qc': 'QCëŒ€ê¸°',
                'completed': 'ì™„ë£Œ'
            };
            return texts[status] || status;
        }

        function updateTableCount() {
            document.getElementById('tableCount').textContent = `ì´ ${currentReports.length}ê°œ ë³´ê³ ì„œ`;
            document.getElementById('paginationInfo').textContent = `1-${Math.min(10, currentReports.length)} / ${currentReports.length}ê°œ ë³´ê³ ì„œ`;
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const author = document.getElementById('authorFilter').value;
            const stage = document.getElementById('stageFilter').value;
            const status = document.querySelector('.filter-chip.active').dataset.status;

            currentReports = allReports.filter(report => {
                const matchesSearch = !searchTerm ||
                    report.name.toLowerCase().includes(searchTerm) ||
                    report.ingredient.toLowerCase().includes(searchTerm);
                const matchesAuthor = !author || report.author === author;
                const matchesStage = !stage || report.stage.toString() === stage;
                const matchesStatus = !status || report.status === status;

                return matchesSearch && matchesAuthor && matchesStage && matchesStatus;
            });

            renderReports();
            if (window.showToast) showToast('í•„í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('authorFilter').value = '';
            document.getElementById('periodFilter').value = '';
            document.getElementById('stageFilter').value = '';

            document.querySelector('.filter-chip.active').classList.remove('active');
            document.querySelector('.filter-chip[data-status=""]').classList.add('active');

            currentReports = [...allReports];
            renderReports();
            if (window.showToast) showToast('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function sortTable(column) {
            if (window.showToast) showToast('ì •ë ¬ ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë©ë‹ˆë‹¤.', 'info');
        }

        // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ (onclickì—ì„œ ì‚¬ìš©)
        window.viewReport = function(id) {
            if (window.navigateTo) navigateTo(`P12_ReportDetail.html?reportId=${id}`);
            else window.location.href = `P12_ReportDetail.html?reportId=${id}`;
        };

        window.editReport = function(id) {
            if (window.navigateTo) navigateTo(`P12_ReportDetail.html?reportId=${id}&mode=edit`);
            else window.location.href = `P12_ReportDetail.html?reportId=${id}&mode=edit`;
        };

        window.deleteReport = async function(id) {
            if (confirm('ì´ ë³´ê³ ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // TODO: DBì—ì„œ ì‚­ì œ êµ¬í˜„
                if (window.showToast) showToast('ì‚­ì œ ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë©ë‹ˆë‹¤.', 'info');
                // currentReports = currentReports.filter(r => r.id !== id);
                // renderReports();
            }
        };

        window.applyFilters = applyFilters;
        window.resetFilters = resetFilters;
        window.sortTable = sortTable;
        window.loadReportsFromDB = loadReportsFromDB;
    </script>
    <script src="../utils/globals.js"></script>
    <script src="../js/config.js"></script>
    <script src="../utils/session.js"></script>
    <script src="../utils/navigation.js"></script>
    <script src="../js/supabase-client.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/permissions.js"></script>
    <script src="../js/page-guard.js"></script>
</body>
</html>
