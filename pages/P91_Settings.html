<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ì„¤ì • - KPSUR AGENT | ACUZEN AI</title>
    <link rel="stylesheet" href="../css/styles/globals.css">
    <link rel="stylesheet" href="../css/styles/layout.css">
    <link rel="stylesheet" href="../css/styles/components.css">
    <style>
        body {
            background: #F3F4F6;
            min-height: 100vh;
            padding: 20px;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .settings-title {
            font-size: 32px;
            font-weight: 700;
            color: #25739B;
            margin-bottom: 8px;
        }

        .settings-subtitle {
            font-size: 14px;
            color: #6B7280;
        }

        .settings-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-label {
            font-size: 14px;
            color: #6B7280;
            font-weight: 500;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #ECFDF5;
            color: #065F46;
            border: 1px solid #6EE7B7;
        }

        .badge-error {
            background: #FEF2F2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
        }

        .masked-key {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #374151;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .input-with-button {
            display: flex;
            gap: 8px;
        }

        .api-key-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #25739B;
            box-shadow: 0 0 0 4px rgba(37, 115, 155, 0.1);
        }

        .toggle-visibility-btn {
            padding: 12px 16px;
            background: #F3F4F6;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .toggle-visibility-btn:hover {
            background: #E5E7EB;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #25739B 0%, #369EE1 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 115, 155, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #25739B;
            border: 2px solid #25739B;
        }

        .btn-secondary:hover {
            background: #F3F4F6;
        }

        .btn-danger {
            background: white;
            color: #DC2626;
            border: 2px solid #DC2626;
        }

        .btn-danger:hover {
            background: #FEF2F2;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .guide-steps {
            counter-reset: step;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .guide-steps li {
            counter-increment: step;
            padding: 12px 0;
            padding-left: 40px;
            position: relative;
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
        }

        .guide-steps li::before {
            content: counter(step);
            position: absolute;
            left: 0;
            top: 12px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #25739B 0%, #369EE1 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }

        .guide-link {
            color: #25739B;
            text-decoration: none;
            font-weight: 600;
        }

        .guide-link:hover {
            text-decoration: underline;
        }

        .security-notice {
            background: #FEF3C7;
            border: 2px solid #FDE047;
            padding: 20px;
            border-radius: 12px;
        }

        .security-notice-title {
            font-size: 15px;
            font-weight: 700;
            color: #92400E;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .security-notice ul {
            margin: 0;
            padding-left: 20px;
            color: #92400E;
            font-size: 13px;
            line-height: 1.8;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .info-item {
            padding: 12px;
            background: #F9FAFB;
            border-radius: 8px;
        }

        .info-label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 14px;
            color: #374151;
            font-weight: 600;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            background: #ECFDF5;
            color: #065F46;
            border: 1px solid #6EE7B7;
        }

        .toast-error {
            background: #FEF2F2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
        }

        .toast-warning {
            background: #FEF3C7;
            color: #92400E;
            border: 1px solid #FDE047;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .loading-content {
            background: white;
            padding: 32px;
            border-radius: 16px;
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #E5E7EB;
            border-top-color: #25739B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: #6B7280;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #25739B;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 24px;
            transition: all 0.2s;
        }

        .back-link:hover {
            gap: 12px;
        }

        /* ë‹¤í¬ëª¨ë“œ ë³€ìˆ˜ */
        :root {
            --page-bg: #F3F4F6;
            --card-bg: white;
            --text-primary: #374151;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --border-color: #E5E7EB;
            --section-bg: #F9FAFB;
            --input-bg: white;
        }

        [data-theme="dark"] {
            --page-bg: #1e293b;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --section-bg: #334155;
            --input-bg: #334155;
        }

        [data-theme="dark"] body {
            background: #1e293b;
        }

        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        [data-theme="dark"] .settings-card {
            background: transparent;
            border: 1px solid #475569;
        }

        [data-theme="dark"] .section-title {
            color: var(--text-primary);
        }

        [data-theme="dark"] .status-row {
            background: #334155;
        }

        [data-theme="dark"] .status-label {
            color: #94a3b8;
        }

        [data-theme="dark"] .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border-color: #34d399;
        }

        [data-theme="dark"] .badge-error {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        [data-theme="dark"] .masked-key {
            color: var(--text-primary);
        }

        [data-theme="dark"] .input-label {
            color: var(--text-primary);
        }

        [data-theme="dark"] .api-key-input {
            background: #334155;
            border-color: #475569;
            color: var(--text-primary);
        }

        [data-theme="dark"] .api-key-input:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.1);
        }

        [data-theme="dark"] .toggle-visibility-btn {
            background: #334155;
            border-color: #475569;
        }

        [data-theme="dark"] .toggle-visibility-btn:hover {
            background: #3f4f63;
        }

        [data-theme="dark"] .btn-secondary {
            background: #334155;
            border-color: #60a5fa;
            color: #60a5fa;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(96, 165, 250, 0.1);
        }

        [data-theme="dark"] .btn-danger {
            background: #334155;
            border-color: #fbbf24;
            color: #fbbf24;
        }

        [data-theme="dark"] .btn-danger:hover {
            background: rgba(251, 191, 36, 0.1);
        }

        [data-theme="dark"] .guide-steps li {
            color: var(--text-primary);
        }

        [data-theme="dark"] .guide-link {
            color: #60a5fa;
        }

        [data-theme="dark"] .security-notice {
            background: rgba(251, 191, 36, 0.15);
            border-color: #fbbf24;
        }

        [data-theme="dark"] .security-notice-title {
            color: #fbbf24;
        }

        [data-theme="dark"] .security-notice ul {
            color: #fcd34d;
        }

        [data-theme="dark"] .info-item {
            background: #334155;
        }

        [data-theme="dark"] .info-label {
            color: #94a3b8;
        }

        [data-theme="dark"] .info-value {
            color: var(--text-primary);
        }

        [data-theme="dark"] .toast-success {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border-color: #34d399;
        }

        [data-theme="dark"] .toast-error {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        [data-theme="dark"] .toast-warning {
            background: rgba(251, 191, 36, 0.15);
            color: #fcd34d;
            border-color: #fcd34d;
        }

        [data-theme="dark"] .loading-content {
            background: #1e293b;
            border: 1px solid #475569;
        }

        [data-theme="dark"] .loading-text {
            color: #94a3b8;
        }

        [data-theme="dark"] .back-link {
            color: #60a5fa;
        }

        /* Multi-LLM Provider Tabs */
        .provider-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 12px;
        }

        .provider-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 2px solid transparent;
            border-radius: 8px;
            background: var(--section-bg);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .provider-tab:hover {
            border-color: var(--border-color);
            background: var(--card-bg);
        }

        .provider-tab.active {
            border-color: #25739B;
            background: rgba(37, 115, 155, 0.1);
            color: #25739B;
        }

        .provider-status {
            font-size: 10px;
        }

        .provider-panel {
            padding: 16px 0;
        }

        .provider-models {
            margin: 16px 0;
            padding: 12px;
            background: var(--section-bg);
            border-radius: 8px;
        }

        .model-list-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .model-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .model-badge {
            padding: 4px 10px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .model-badge.premium {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            border: none;
        }

        .model-badge.economy {
            background: #D1FAE5;
            color: #065F46;
            border-color: #6EE7B7;
        }

        .api-summary {
            margin-top: 24px;
            padding: 16px;
            background: var(--section-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .summary-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .summary-icon {
            font-size: 18px;
        }

        .summary-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .summary-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: #FEE2E2;
            color: #991B1B;
        }

        .summary-item.configured .summary-status {
            background: #D1FAE5;
            color: #065F46;
        }

        [data-theme="dark"] .provider-tab {
            background: #334155;
            color: #94a3b8;
        }

        [data-theme="dark"] .provider-tab.active {
            background: rgba(96, 165, 250, 0.15);
            border-color: #60a5fa;
            color: #60a5fa;
        }

        [data-theme="dark"] .provider-models {
            background: #334155;
        }

        [data-theme="dark"] .model-badge {
            background: #475569;
            border-color: #475569;
            color: var(--text-primary);
        }

        [data-theme="dark"] .model-badge.economy {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border-color: #34d399;
        }

        [data-theme="dark"] .api-summary {
            background: #334155;
            border-color: #475569;
        }

        [data-theme="dark"] .summary-item {
            background: #1e293b;
            border-color: #475569;
        }

        [data-theme="dark"] .summary-status {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        [data-theme="dark"] .summary-item.configured .summary-status {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        @media (max-width: 768px) {
            .provider-tabs {
                flex-direction: column;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Header styles */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo {
            font-size: 18px;
            font-weight: 700;
            color: #25739B;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark-mode-toggle {
            background: var(--section-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .dark-mode-toggle:hover {
            border-color: #25739B;
        }

        [data-theme="dark"] .dark-mode-toggle {
            background: #334155;
            border-color: #475569;
        }

        .icon-sun, .icon-moon {
            font-size: 16px;
        }

        [data-theme="light"] .icon-moon {
            display: none;
        }

        [data-theme="dark"] .icon-sun {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Dark Mode Script -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }
    </script>

    <!-- Header -->
    <header class="app-header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-text">KPSUR AGENT</span>
                <span class="logo-subtitle">ACUZEN AI</span>
            </div>
            <span class="deployment-badge test">í…ŒìŠ¤íŠ¸</span>
        </div>

        <div class="header-center">
            <div class="breadcrumb">
                <span class="breadcrumb-item">ì‹œìŠ¤í…œ</span>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-item active">ì‹œìŠ¤í…œ ì„¤ì •</span>
            </div>
        </div>

        <div class="header-right">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
                <span class="icon-sun">â˜€ï¸</span>
                <span class="icon-moon">ğŸŒ™</span>
            </button>
            <div class="user-menu">
                <div class="user-avatar">ì‚¬</div>
                <div class="user-info">
                    <div class="user-name">ì‚¬ìš©ì</div>
                    <div class="user-role">Admin</div>
                </div>
                <button class="user-menu-toggle">â–¼</button>
            </div>
        </div>
    </header>

    <div class="app-layout">
    <div class="app-content">
    <main class="main-content">
    <div class="settings-container">
        <a href="../index.html" class="back-link">
            â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        </a>

        <div class="settings-header">
            <div class="settings-title">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</div>
            <div class="settings-subtitle">KPSUR AGENT ì‹œìŠ¤í…œ êµ¬ì„± ê´€ë¦¬</div>
        </div>

        <!-- First Setup Banner (shown only when redirected from initial setup) -->
        <div id="firstSetupBanner" style="display: none; background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%); border: 2px solid #3B82F6; border-radius: 12px; padding: 24px; margin-bottom: 24px; text-align: center;">
            <div style="font-size: 24px; margin-bottom: 12px;">ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤!</div>
            <div style="font-size: 16px; font-weight: 600; color: #1E40AF; margin-bottom: 8px;">
                KPSUR AGENTë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¨¼ì € API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”
            </div>
            <div style="font-size: 14px; color: #1E40AF; line-height: 1.6;">
                Google Gemini API í‚¤ëŠ” ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìœ¼ë©°,<br>
                ì•„ë˜ ê°€ì´ë“œë¥¼ ë”°ë¼ ì„¤ì •í•˜ì‹œë©´ ë°”ë¡œ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>

        <!-- Section 1: Multi-LLM API Key Management -->
        <div class="settings-card">
            <div class="section-title">
                <span>ğŸ”‘</span>
                <span>Multi-LLM API í‚¤ ê´€ë¦¬</span>
            </div>

            <!-- Provider Tabs -->
            <div class="provider-tabs">
                <button class="provider-tab active" data-provider="anthropic" onclick="switchProvider('anthropic')">
                    <span class="provider-icon">ğŸŸ£</span>
                    <span>Anthropic (Claude)</span>
                    <span class="provider-status" id="status-anthropic">â—‹</span>
                </button>
                <button class="provider-tab" data-provider="openai" onclick="switchProvider('openai')">
                    <span class="provider-icon">ğŸŸ¢</span>
                    <span>OpenAI (GPT)</span>
                    <span class="provider-status" id="status-openai">â—‹</span>
                </button>
                <button class="provider-tab" data-provider="google" onclick="switchProvider('google')">
                    <span class="provider-icon">ğŸ”µ</span>
                    <span>Google (Gemini)</span>
                    <span class="provider-status" id="status-google">â—‹</span>
                </button>
            </div>

            <!-- Anthropic Panel -->
            <div class="provider-panel" id="panel-anthropic">
                <div class="status-row">
                    <div>
                        <div class="status-label">í˜„ì¬ ìƒíƒœ</div>
                        <span class="badge" id="badge-anthropic">âŒ ë¯¸ì„¤ì •</span>
                    </div>
                    <div>
                        <div class="status-label">ì €ì¥ëœ í‚¤</div>
                        <span class="masked-key" id="masked-anthropic">-</span>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Anthropic API í‚¤</label>
                    <div class="input-with-button">
                        <input type="password" id="input-anthropic" class="api-key-input" placeholder="sk-ant-api03-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤">
                        <button class="toggle-visibility-btn" onclick="toggleVisibility('anthropic')">ğŸ‘ï¸</button>
                    </div>
                </div>
                <div class="provider-models">
                    <div class="model-list-label">ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸:</div>
                    <div class="model-badges">
                        <span class="model-badge premium">Claude Opus 4.5</span>
                        <span class="model-badge">Claude Sonnet 3.5</span>
                        <span class="model-badge">Claude Haiku 3.5</span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveApiKey('anthropic')">ğŸ’¾ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="testApiKey('anthropic')">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button class="btn btn-danger" onclick="clearApiKey('anthropic')">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            </div>

            <!-- OpenAI Panel -->
            <div class="provider-panel" id="panel-openai" style="display: none;">
                <div class="status-row">
                    <div>
                        <div class="status-label">í˜„ì¬ ìƒíƒœ</div>
                        <span class="badge" id="badge-openai">âŒ ë¯¸ì„¤ì •</span>
                    </div>
                    <div>
                        <div class="status-label">ì €ì¥ëœ í‚¤</div>
                        <span class="masked-key" id="masked-openai">-</span>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">OpenAI API í‚¤</label>
                    <div class="input-with-button">
                        <input type="password" id="input-openai" class="api-key-input" placeholder="sk-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤">
                        <button class="toggle-visibility-btn" onclick="toggleVisibility('openai')">ğŸ‘ï¸</button>
                    </div>
                </div>
                <div class="provider-models">
                    <div class="model-list-label">ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸:</div>
                    <div class="model-badges">
                        <span class="model-badge">GPT-4o</span>
                        <span class="model-badge">GPT-4o Mini</span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveApiKey('openai')">ğŸ’¾ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="testApiKey('openai')">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button class="btn btn-danger" onclick="clearApiKey('openai')">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            </div>

            <!-- Google Panel -->
            <div class="provider-panel" id="panel-google" style="display: none;">
                <div class="status-row">
                    <div>
                        <div class="status-label">í˜„ì¬ ìƒíƒœ</div>
                        <span class="badge" id="badge-google">âŒ ë¯¸ì„¤ì •</span>
                    </div>
                    <div>
                        <div class="status-label">ì €ì¥ëœ í‚¤</div>
                        <span class="masked-key" id="masked-google">-</span>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Google Gemini API í‚¤</label>
                    <div class="input-with-button">
                        <input type="password" id="input-google" class="api-key-input" placeholder="AIzaë¡œ ì‹œì‘í•˜ëŠ” í‚¤">
                        <button class="toggle-visibility-btn" onclick="toggleVisibility('google')">ğŸ‘ï¸</button>
                    </div>
                </div>
                <div class="provider-models">
                    <div class="model-list-label">ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸:</div>
                    <div class="model-badges">
                        <span class="model-badge">Gemini 2.0 Pro</span>
                        <span class="model-badge economy">Gemini 2.5 Flash (ë¬´ë£Œ)</span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveApiKey('google')">ğŸ’¾ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="testApiKey('google')">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button class="btn btn-danger" onclick="clearApiKey('google')">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            </div>

            <!-- API Key Summary -->
            <div class="api-summary">
                <div class="summary-title">ğŸ” API í‚¤ ì„¤ì • í˜„í™©</div>
                <div class="summary-grid">
                    <div class="summary-item" id="summary-anthropic">
                        <span class="summary-icon">ğŸŸ£</span>
                        <span class="summary-name">Anthropic</span>
                        <span class="summary-status">ë¯¸ì„¤ì •</span>
                    </div>
                    <div class="summary-item" id="summary-openai">
                        <span class="summary-icon">ğŸŸ¢</span>
                        <span class="summary-name">OpenAI</span>
                        <span class="summary-status">ë¯¸ì„¤ì •</span>
                    </div>
                    <div class="summary-item" id="summary-google">
                        <span class="summary-icon">ğŸ”µ</span>
                        <span class="summary-name">Google</span>
                        <span class="summary-status">ë¯¸ì„¤ì •</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: API Key Issuance Guide -->
        <div class="settings-card">
            <div class="section-title">
                <span>ğŸ“‹</span>
                <span>API í‚¤ ë°œê¸‰ ê°€ì´ë“œ</span>
            </div>

            <ol class="guide-steps">
                <li>
                    <a href="https://ai.google.dev/" target="_blank" class="guide-link">Google AI Studio</a> ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì„¸ìš”
                </li>
                <li>
                    ìš°ì¸¡ ìƒë‹¨ì˜ <strong>"Get API Key"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                </li>
                <li>
                    í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡œ ìƒì„±í•˜ì„¸ìš”
                </li>
                <li>
                    ìƒì„±ëœ API í‚¤ë¥¼ ë³µì‚¬í•˜ì—¬ ìœ„ ì…ë ¥ë€ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
                </li>
                <li>
                    "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ í‚¤ê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
                </li>
                <li>
                    í…ŒìŠ¤íŠ¸ ì„±ê³µ í›„ "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                </li>
            </ol>

            <div style="margin-top: 16px; padding: 12px; background: #EFF6FF; border-radius: 8px; font-size: 13px; color: #1E40AF;">
                ğŸ’¡ <strong>ë¬´ë£Œ í• ë‹¹ëŸ‰:</strong> ë¶„ë‹¹ 15íšŒ, ì¼ì¼ 1,500íšŒ ìš”ì²­ ê°€ëŠ¥
            </div>
        </div>

        <!-- Section 3: Security Notice -->
        <div class="settings-card security-notice">
            <div class="security-notice-title">
                <span>âš ï¸</span>
                <span>ë³´ì•ˆ ì£¼ì˜ì‚¬í•­</span>
            </div>
            <ul>
                <li>API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì˜ localStorageì—ë§Œ ì €ì¥ë˜ë©°, ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
                <li>ê³µìš© ì»´í“¨í„°ì—ì„œ ì‚¬ìš© í›„ì—ëŠ” ë°˜ë“œì‹œ ë¡œê·¸ì•„ì›ƒí•˜ê³  "ì‚­ì œ" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</li>
                <li>API í‚¤ë¥¼ ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”</li>
                <li>ìŠ¤í¬ë¦°ìƒ·ì´ë‚˜ í™”ë©´ ê³µìœ  ì‹œ API í‚¤ê°€ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”</li>
                <li>ì‚¬ìš©ëŸ‰ì€ <a href="https://console.cloud.google.com/" target="_blank" class="guide-link">Google Cloud Console</a>ì—ì„œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            </ul>
        </div>

        <!-- Section 4: Cost Tracking -->
        <div class="settings-card">
            <div class="section-title">
                <span>ğŸ’°</span>
                <span>LLM ì‚¬ìš© ë¹„ìš© ì¶”ì </span>
            </div>

            <!-- Cost Tracker Widget Container -->
            <div id="costTrackerContainer"></div>

            <div style="margin-top: 16px; padding: 16px; background: var(--section-bg); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">ğŸ“Š ìƒì„¸ ë¹„ìš© ê¸°ë¡</span>
                    <button class="btn btn-secondary" onclick="exportCostHistory()" style="font-size: 12px; padding: 6px 12px;">
                        ğŸ“¥ ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
                <div id="recentCostsList" style="max-height: 200px; overflow-y: auto;">
                    <p style="color: var(--text-muted); font-size: 12px; text-align: center;">ë¡œë”© ì¤‘...</p>
                </div>
            </div>

            <div class="button-group" style="margin-top: 16px;">
                <button class="btn btn-danger" onclick="clearCostHistory()">ğŸ—‘ï¸ ê¸°ë¡ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- Section 5: System Info -->
        <div class="settings-card">
            <div class="section-title">
                <span>â„¹ï¸</span>
                <span>ì‹œìŠ¤í…œ ì •ë³´</span>
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">í™˜ê²½ ëª¨ë“œ</div>
                    <div class="info-value" id="envMode">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">í˜¸ìŠ¤íŠ¸</div>
                    <div class="info-value" id="hostname">-</div>
                </div>
            </div>
        </div>
    </div>
    </main>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            Copyright. Power Solution., Inc. 2026.
        </div>
    </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">ì²˜ë¦¬ ì¤‘...</div>
        </div>
    </div>

    <!-- Security & Navigation -->
    <script src="../utils/session.js"></script>
    <script src="../utils/navigation.js"></script>

    <!-- Cost Tracker Script -->
    <script src="../js/cost-tracker.js"></script>

    <script>
        // Multi-LLM Settings Manager
        const providers = ['anthropic', 'openai', 'google'];
        let currentProvider = 'anthropic';

        const apiEndpoints = {
            anthropic: 'https://api.anthropic.com/v1/messages',
            openai: 'https://api.openai.com/v1/models',
            google: 'https://generativelanguage.googleapis.com/v1beta/models'
        };

        const storageKeys = {
            anthropic: 'anthropic_api_key',
            openai: 'openai_api_key',
            google: 'gemini_api_key'
        };

        // Get API key for provider
        function getApiKey(provider) {
            return localStorage.getItem(storageKeys[provider]);
        }

        // Set API key for provider
        function setApiKeyStorage(provider, key) {
            localStorage.setItem(storageKeys[provider], key);
            return true;
        }

        // Remove API key for provider
        function removeApiKey(provider) {
            localStorage.removeItem(storageKeys[provider]);
            return true;
        }

        // Mask API key for display
        function maskApiKey(key) {
            if (!key) return '-';
            return key.substring(0, 8) + '...' + key.substring(key.length - 4);
        }

        // Initialize page
        async function initSettingsPage() {
            checkFirstSetup();
            updateAllProviderStatus();
            displayEnvironmentInfo();
            initCostTracker();
        }

        // Check if redirected from first setup
        function checkFirstSetup() {
            const urlParams = new URLSearchParams(window.location.search);
            const isFirstSetup = urlParams.get('firstSetup') === 'true';

            if (isFirstSetup) {
                document.getElementById('firstSetupBanner').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('input-google').focus();
                    switchProvider('google');
                }, 500);
            }
        }

        // Switch provider panel
        function switchProvider(provider) {
            currentProvider = provider;

            // Update tabs
            document.querySelectorAll('.provider-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.provider === provider);
            });

            // Update panels
            providers.forEach(p => {
                const panel = document.getElementById(`panel-${p}`);
                if (panel) {
                    panel.style.display = p === provider ? 'block' : 'none';
                }
            });
        }

        // Update status for all providers
        function updateAllProviderStatus() {
            providers.forEach(provider => {
                updateProviderStatus(provider);
            });
        }

        // Update status for a single provider
        function updateProviderStatus(provider) {
            const key = getApiKey(provider);
            const configured = !!key;

            // Update badge
            const badge = document.getElementById(`badge-${provider}`);
            if (badge) {
                badge.textContent = configured ? 'âœ… ì„¤ì •ë¨' : 'âŒ ë¯¸ì„¤ì •';
                badge.className = `badge ${configured ? 'badge-success' : 'badge-error'}`;
            }

            // Update masked key
            const masked = document.getElementById(`masked-${provider}`);
            if (masked) {
                masked.textContent = maskApiKey(key);
            }

            // Update tab status
            const tabStatus = document.getElementById(`status-${provider}`);
            if (tabStatus) {
                tabStatus.textContent = configured ? 'â—' : 'â—‹';
                tabStatus.style.color = configured ? '#10B981' : '#9CA3AF';
            }

            // Update summary
            const summary = document.getElementById(`summary-${provider}`);
            if (summary) {
                summary.classList.toggle('configured', configured);
                const statusEl = summary.querySelector('.summary-status');
                if (statusEl) {
                    statusEl.textContent = configured ? 'ì„¤ì •ë¨' : 'ë¯¸ì„¤ì •';
                }
            }
        }

        // Display environment information
        function displayEnvironmentInfo() {
            const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            document.getElementById('envMode').textContent = isLocal ? 'Development' : 'Production';
            document.getElementById('hostname').textContent = window.location.hostname;
        }

        // Save API key for current provider
        async function saveApiKey(provider) {
            const input = document.getElementById(`input-${provider}`).value.trim();

            if (!input) {
                showToast('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                return;
            }

            // Test connection before saving
            showLoading('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
            const testResult = await testApiKeyConnection(provider, input);
            hideLoading();

            if (!testResult.success) {
                showToast('âŒ ' + (testResult.message || 'ì—°ê²° ì‹¤íŒ¨'), 'error');
                return;
            }

            // Save to localStorage
            setApiKeyStorage(provider, input);
            updateProviderStatus(provider);
            document.getElementById(`input-${provider}`).value = '';
            showToast('âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');

            // If this was first setup, redirect to dashboard
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('firstSetup') === 'true') {
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1500);
            }
        }

        // Test API key connection
        async function testApiKey(provider) {
            const input = document.getElementById(`input-${provider}`).value.trim();
            const storedKey = getApiKey(provider);
            const keyToTest = input || storedKey;

            if (!keyToTest) {
                showToast('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                return;
            }

            showLoading('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
            const result = await testApiKeyConnection(provider, keyToTest);
            hideLoading();

            if (result.success) {
                showToast('âœ… ì—°ê²° ì„±ê³µ!', 'success');
            } else {
                showToast('âŒ ' + (result.message || 'ì—°ê²° ì‹¤íŒ¨'), 'error');
            }
        }

        // Test API connection for provider
        async function testApiKeyConnection(provider, key) {
            try {
                let response;

                switch (provider) {
                    case 'anthropic':
                        // Anthropic requires a POST request with specific headers
                        response = await fetch('https://api.anthropic.com/v1/messages', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'x-api-key': key,
                                'anthropic-version': '2023-06-01',
                                'anthropic-dangerous-direct-browser-access': 'true'
                            },
                            body: JSON.stringify({
                                model: 'claude-3-haiku-20240307',
                                max_tokens: 10,
                                messages: [{ role: 'user', content: 'Hi' }]
                            })
                        });
                        break;

                    case 'openai':
                        response = await fetch('https://api.openai.com/v1/models', {
                            headers: {
                                'Authorization': `Bearer ${key}`
                            }
                        });
                        break;

                    case 'google':
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                        break;
                }

                if (response.ok || response.status === 200) {
                    return { success: true };
                } else {
                    const errorText = await response.text();
                    return { success: false, message: `HTTP ${response.status}` };
                }
            } catch (error) {
                return { success: false, message: error.message };
            }
        }

        // Clear API key for provider
        function clearApiKey(provider) {
            if (!confirm(`${provider.toUpperCase()} API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            removeApiKey(provider);
            updateProviderStatus(provider);
            document.getElementById(`input-${provider}`).value = '';
            showToast('âœ… API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // Toggle password visibility for provider
        function toggleVisibility(provider) {
            const input = document.getElementById(`input-${provider}`);
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast toast-${type}`;
            toast.style.display = 'block';

            setTimeout(() => {
                toast.style.display = 'none';
            }, 5000);
        }

        // Show loading overlay
        function showLoading(text = 'ì²˜ë¦¬ ì¤‘...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ==========================================
        // Cost Tracker Functions
        // ==========================================

        // Initialize cost tracker widget
        function initCostTracker() {
            if (window.costTracker) {
                window.costTracker.createCostWidget('costTrackerContainer');
                renderRecentCosts();

                // Listen for cost updates
                window.addEventListener('costUpdated', renderRecentCosts);
                window.addEventListener('costCleared', renderRecentCosts);
            } else {
                console.warn('Cost tracker not loaded');
                document.getElementById('costTrackerContainer').innerHTML = `
                    <p style="color: var(--text-muted); font-size: 13px; text-align: center; padding: 20px;">
                        ë¹„ìš© ì¶”ì  ëª¨ë“ˆ ë¡œë”© ì‹¤íŒ¨
                    </p>
                `;
            }
        }

        // Render recent cost records
        function renderRecentCosts() {
            const container = document.getElementById('recentCostsList');
            if (!container || !window.costTracker) return;

            const records = window.costTracker.getRecentRecords(10);

            if (records.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-muted); font-size: 12px; text-align: center; padding: 16px;">
                        ì•„ì§ ë¹„ìš© ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
                    </p>
                `;
                return;
            }

            container.innerHTML = records.map(record => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin-bottom: 6px; background: var(--card-bg); border-radius: 6px; border: 1px solid var(--border-color);">
                    <div>
                        <div style="font-size: 13px; font-weight: 500; color: var(--text-primary);">
                            ${record.model}
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted);">
                            ${formatTimestamp(record.timestamp)} Â· ${record.inputTokens + record.outputTokens} tokens
                        </div>
                    </div>
                    <div style="font-size: 14px; font-weight: 600; color: #25739B;">
                        ${window.costTracker.formatCost(record.cost)}
                    </div>
                </div>
            `).join('');
        }

        // Format timestamp
        function formatTimestamp(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('ko-KR', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Export cost history
        function exportCostHistory() {
            if (!window.costTracker) return;

            const records = window.costTracker.history;
            const stats = window.costTracker.getStatistics();

            let csv = 'Timestamp,Provider,Model,Input Tokens,Output Tokens,Cost ($)\n';
            records.forEach(r => {
                csv += `${r.timestamp},${r.provider},${r.model},${r.inputTokens},${r.outputTokens},${r.cost.toFixed(6)}\n`;
            });

            csv += `\n\nSummary\n`;
            csv += `Total Cost,$${stats.monthTotal.toFixed(4)}\n`;
            csv += `Total Records,${stats.totalRecords}\n`;

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `llm_cost_history_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(url);

            showToast('ë¹„ìš© ê¸°ë¡ì´ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤', 'success');
        }

        // Clear cost history
        function clearCostHistory() {
            if (!confirm('ëª¨ë“  ë¹„ìš© ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            if (window.costTracker) {
                window.costTracker.clearHistory();
                renderRecentCosts();
                showToast('ë¹„ìš© ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initSettingsPage);
    </script>
</body>
</html>
