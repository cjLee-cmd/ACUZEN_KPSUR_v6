# 제작 사양서 검토 - 불명확한 사항 및 협의 필요 항목

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 제작 사양서 검토 - 불명확한 사항 |
| 검토 대상 | 06_ProductSpecification.md |
| 검토일 | 2025-12-29 |
| 목적 | 실제 개발 전 불명확한 사항 명확화 |

---

## 협의 필요 사항 요약

총 **13개 카테고리, 45개 세부 항목**에 대한 명확화 필요

### 우선순위 분류

| 우선순위 | 개수 | 설명 |
|---------|------|------|
| 🔴 **High** | 15개 | 즉시 결정 필요 (워크플로우 변경 가능성) |
| 🟡 **Medium** | 20개 | 구현 전 명확화 필요 |
| 🟢 **Low** | 10개 | 개발 중 결정 가능 |

---

# 상세 검토 내용

## 🔴 1. [High] Stage 2 - 사용자 입력 정보 불일치

### 문제점

**워크플로우 (01_Workflow.md)**:
```markdown
사용자 입력 내용은 아래와 같음.
| Variable ID | 설명 |
|-------------|------|
| CS6_보고서제출일 | PSUR 제출일 |
| CS7_버전넘버 | 보고서 버전 (예: 1.0) |
| CS13_유효기간 | 품목 유효기간 |
| CS20_1일사용량 | 바이알 기준 1일 사용량 |
| CS21_환자1명당사용량 | 연간 사용량 |
| CS24_MedDRA버전넘버 | 사용된 MedDRA 버전 |
```
**총 6개 변수**

**제작 사양서 (06_ProductSpecification.md)**:
```markdown
**입력 폼**:
| 필드 | 타입 | 필수 | 검증 |
|------|------|------|------|
| CS0_성분명 | text | ✅ | 1-100자 |
| CS1_브랜드명 | text | ✅ | 1-100자 |
| CS2_회사명 | text | ✅ | 1-100자 |
| CS4_보고종료날짜 | date | ✅ | YYYY-MM-DD |
| CS5_국내허가일자 | date | ✅ | YYYY-MM-DD, CS4 이전 |
| CS6_보고서제출일 | date | ✅ | YYYY-MM-DD, CS4 이후 |
| CS7_버전넘버 | text | ✅ | 예: 1.0 |
| CS13_유효기간 | date | ✅ | YYYY-MM-DD, CS6 이후 |
| CS20_1일사용량 | number | ✅ | 양수 |
| CS21_환자1명당사용량 | number | ✅ | 양수 |
| CS24_MedDRA버전넘버 | text | ✅ | 예: 26.0 |
```
**총 11개 변수 (5개 추가됨)**

### 협의 필요 사항

**Q1-1**: 추가된 5개 변수 (CS0, CS1, CS2, CS4, CS5)는:
- ✅ **옵션 A**: 워크플로우에 누락된 것으로, 사양서가 정확함
- ❌ **옵션 B**: 사양서에 잘못 추가된 것으로, 워크플로우가 정확함
- ❓ **옵션 C**: 일부는 필요, 일부는 불필요 (구체적으로 명시 필요)

**Q1-2**: 자동 계산 로직이 사양서에 추가됨:
```markdown
**자동 계산**:
- CS3 = CS4 - 5년
- CS8 = CS4 (동일값)
- CS14 = CS13 - 6개월
```
이 로직의 출처는?
- ✅ **옵션 A**: 실제 업무 규칙 (워크플로우에 누락)
- ❌ **옵션 B**: 사양서 작성 시 추론한 내용 (검증 필요)

**Q1-3**: 날짜 검증 규칙:
```markdown
CS5_국내허가일자 < CS4_보고종료날짜 < CS6_보고서제출일 < CS13_유효기간
```
이 순서가 실제 업무 규칙과 일치하는가?

### 권장 조치

1. 워크플로우 문서 업데이트 필요
2. CS 데이터 정의 문서 (`0111_CSData_Definition.md`) 재확인
3. 실제 보고서 샘플과 대조

---

## 🔴 2. [High] RAW ID 분류 - 필수/선택 구분 불명확

### 문제점

**워크플로우**: RAW ID 목록만 제공, 필수/선택 구분 없음

**제작 사양서**: 필수/선택 구분 있음
```markdown
| RAW ID | 설명 | 필수 |
|--------|------|------|
| RAW1 | 최신첨부문서 | ✅ |
| RAW2.1 | 용법용량 | ✅ |
| RAW2.2 | 효능효과 | ✅ |
| RAW2.3 | 사용상의주의사항 | ✅ |
| RAW3 | 시판후sales데이터 | ✅ |
| RAW4 | 허가현황 | ✅ |
| RAW5.1 | 안전성조치허가메일 | (선택) |
| RAW12 | 국외신속보고LineListing | (선택) |
...
```

**워크플로우에서 누락된 RAW ID**:
- RAW2.6 (보고서작성지침사용상의주의사항)
- RAW6.1 (안전성조치허가메일_취합본)
- RAW7.1, RAW7.2, RAW7.3, RAW7.4 (안전성정보변경 관련)

### 협의 필요 사항

**Q2-1**: 필수 RAW ID 6개가 정확한가?
- RAW1, RAW2.1, RAW2.2, RAW2.3, RAW3, RAW4

**Q2-2**: 워크플로우에 있지만 사양서에서 누락된 RAW ID들의 처리:
- RAW2.6, RAW6.1, RAW7.1~7.4는 선택으로 추가해야 하는가?
- 아니면 제거해야 하는가?

**Q2-3**: "필수 파일 확인" 로직:
```typescript
if (!hasRAW1 || !hasRAW2_1 || !hasRAW2_2 ||
    !hasRAW2_3 || !hasRAW3 || !hasRAW4) {
  // 다음 단계 진행 불가
  showWarning("필수 파일이 누락되었습니다");
}
```
이 로직이 정확한가?

### 권장 조치

1. RAW ID 전체 목록 재정의
2. 각 RAW ID별 필수/선택 명확히 구분
3. 워크플로우 문서 업데이트

---

## 🟡 3. [Medium] Stage 4 - 파일 크기 및 타임아웃 제한

### 문제점

**제작 사양서**:
```markdown
**파일 크기 제한**:
- 최대 50MB/파일
- 총 500MB/보고서

**변환 타임아웃**: 150초
```

**워크플로우**: 언급 없음

### 협의 필요 사항

**Q3-1**: 파일 크기 제한이 실제 업무에 적합한가?
- 실제 소스 문서 평균 크기는?
- 최대 몇 개 파일이 업로드되는가?

**Q3-2**: 150초 타임아웃이 충분한가?
- PDF 100페이지 변환 시 예상 시간은?
- Excel 50개 시트 변환 시 예상 시간은?

**Q3-3**: 초과 시 처리 방법:
- ✅ **옵션 A**: 파일 분할 요청
- ✅ **옵션 B**: 에러 메시지 표시 후 재시도
- ✅ **옵션 C**: 타임아웃 연장 (최대 300초)

### 권장 조치

실제 소스 문서 샘플로 테스트 후 결정

---

## 🔴 4. [High] Stage 5 - 데이터 추출 충돌 해결 정책

### 문제점

**워크플로우**:
```markdown
## Critical Development Rules
### Data Extraction (MANDATORY)
🚫 NEVER GENERATE MISSING DATA
⚠️ NEVER ARBITRARILY SELECT CONFLICTING DATA
```

**제작 사양서**:
충돌 해결 UI 제공:
```markdown
┌────────────────────────────────────────┐
│ CS15_효능효과 불일치 발견               │
│                                        │
│ ○ 값 1 (RAW2.2, 2021-03-05):           │
│   "16세 이상 코로나19 예방"             │
│                                        │
│ ○ 값 2 (RAW1, 2021-07-16):             │
│   "12세 이상 코로나19 예방"             │
│                                        │
│ [확정]  [두 문서 비교]                  │
└────────────────────────────────────────┘
```

### 협의 필요 사항

**Q4-1**: 충돌 시 자동 해결 규칙이 있는가?
- ✅ **규칙 A**: 항상 최신 문서 우선 (날짜 기준)
- ✅ **규칙 B**: 특정 RAW ID 우선 (예: RAW1 > RAW2.x)
- ✅ **규칙 C**: 항상 사용자 선택 (자동 해결 없음)

**Q4-2**: 누락 데이터 처리:
```markdown
문제: CS15_효능효과를 RAW2.2에서 찾을 수 없음
```
이 경우:
- ✅ **옵션 A**: 필수 데이터면 다음 단계 진행 불가
- ✅ **옵션 B**: 사용자 수동 입력 허용
- ✅ **옵션 C**: 다른 RAW ID에서 재시도

**Q4-3**: 데이터 우선순위:
`0114_CS_from_Source.md`에 정의된 RAW ID 매핑에 우선순위가 있는가?
예: CS15는 RAW2.2에서 추출이 원칙이지만, 실패 시 RAW1 시도?

### 권장 조치

1. 충돌 해결 정책 명문화
2. RAW ID별 우선순위 테이블 작성
3. 필수/선택 데이터 구분

---

## 🟡 5. [Medium] Stage 6 - 템플릿 파일 위치 및 존재 여부

### 문제점

**제작 사양서**:
```markdown
**템플릿 소스**:
- 경로: `03_Template/02_Sections/`
- 파일: `00_표지.md` ~ `14_별첨.md`
```

**실제 프로젝트 구조**: 확인 필요

### 협의 필요 사항

**Q5-1**: 템플릿 파일이 실제로 존재하는가?
- 경로: `/Users/cjlee/Documents/진행중/ACUZEN/02_KSUR_v6/03_Template/02_Sections/`

**Q5-2**: 템플릿 파일 형식:
- 마크다운 변수 표기: `{{CS1}}` vs `[CS1]` vs `{CS1}`
- 어떤 표기법을 사용하는가?

**Q5-3**: 템플릿 버전 관리:
- 템플릿이 변경되면 어떻게 관리하는가?
- DB에 저장? Git으로 관리?

### 권장 조치

1. 템플릿 파일 존재 여부 확인
2. 샘플 템플릿 1~2개 검토
3. 변수 표기법 통일

---

## 🟡 6. [Medium] Stage 6 - 목차/약어 자동 생성

### 문제점

**제작 사양서**:
```markdown
**목차 자동 생성**:
- 모든 섹션의 헤더 추출
- 목차 및 표목차 생성
- 페이지 번호는 Word 출력 시 자동 생성

**약어설명 자동 생성**:
- 전체 문서에서 약어 추출
- 기준 약어표 (`02_약어설명.md`)와 매칭
- 사용된 약어만 표시
```

**워크플로우**: 언급 없음

### 협의 필요 사항

**Q6-1**: 목차 자동 생성 범위:
- ✅ **범위 A**: # (H1), ## (H2)만
- ✅ **범위 B**: # (H1), ## (H2), ### (H3)까지
- ✅ **범위 C**: 사용자 선택

**Q6-2**: 표목차 생성:
- "표1", "표2" 등을 어떻게 추출하는가?
- 마크다운에서 표 캡션이 명시되어 있는가?

**Q6-3**: 약어 추출 로직:
- 정규식 패턴은? (예: 대문자 2자 이상)
- 기준 약어표 파일이 존재하는가?

### 권장 조치

1. 목차/약어 자동 생성 로직 상세 설계
2. 기준 약어표 파일 확인
3. 샘플 문서로 테스트

---

## 🟢 7. [Low] Stage 7 - 리뷰 권한 및 역할

### 문제점

**제작 사양서**:
```markdown
접근 권한: Master, Author, Reviewer
```

**워크플로우**:
```markdown
제작된 섹션별 마크다운 보고서를 섹션별로 보여주고 수정하도록 구성.
```
→ 누가 수정하는지 명시 안 됨

### 협의 필요 사항

**Q7-1**: 리뷰 단계 역할 분리:
- **Author**: 직접 수정 가능
- **Reviewer**: 코멘트만 가능? 아니면 수정도 가능?
- **Master**: 모든 권한

**Q7-2**: Reviewer의 승인 프로세스:
- Reviewer가 승인해야 QC 단계로 진행?
- 아니면 Author 혼자 진행 가능?

**Q7-3**: 변경 이력 추적:
- 누가, 언제, 무엇을 변경했는지 추적
- UI에 표시하는가?

### 권장 조치

역할별 권한 매트릭스 작성

---

## 🔴 8. [High] Stage 8 - QC 모델 선택

### 문제점

**워크플로우**:
```markdown
매우 중요한 작업이므로 지침에 'Ultrathink, Think Hard, Think step by step, Take your time'등 삽입.
```

**제작 사양서**:
```markdown
LLM이 교차 검증 수행 (Gemini 2.0 Flash-Thinking)
```

**기술 스택 문서 (02_TechStack.md)**:
```markdown
| 모델 | 용도 | RPM | TPM |
|------|------|-----|-----|
| Gemini 2.0 Flash | 기본 작업 | 15 | 1M |
| Gemini 2.0 Flash-Thinking | 복잡한 분석 (QC) | 15 | 1M |
```

### 협의 필요 사항

**Q8-1**: QC에 Flash-Thinking 모델 사용 확정인가?
- ✅ 확정
- ❌ Flash 모델도 고려
- ❓ 사용자 선택 가능하게

**Q8-2**: QC 프롬프트에 "Ultrathink, Think Hard..." 지침 포함?
- Flash-Thinking 모델은 자체적으로 사고 과정을 수행하므로 중복일 수 있음

**Q8-3**: QC 검증 소요 시간:
- Flash-Thinking 모델 사용 시 예상 시간은?
- 타임아웃 설정 필요?

### 권장 조치

1. QC 프롬프트 설계 및 테스트
2. Flash vs Flash-Thinking 성능 비교
3. 비용 vs 품질 검토

---

## 🟡 9. [Medium] Stage 8 - QC 검증 항목 우선순위

### 문제점

**제작 사양서**:
```markdown
**검증 항목**:
1. 데이터 일치성
2. 누락 확인
3. 표 번호 순서
4. 계산 정확성
5. 서술문 일관성
```

**워크플로우**:
```markdown
- 페이지가 정상 작성되었는지 확인.
- 표가 없어서 삭제된 경우, 표 제목이 순차적으로 작성 되었는지 확인.
- 특히, 'CS 데이터', 'PH 데이터', 'Table 데이터'가 각 소스문서의 내용과 상충되는 부분이 없는지 전체 분석.
- '서술문'의 내용이 원본문서의 내용에 위배되는지 확인.
```

### 협의 필요 사항

**Q9-1**: 검증 항목 우선순위:
어떤 이슈가 가장 Critical한가?
1. 데이터 불일치 (Critical)
2. 계산 오류 (Critical)
3. 표 번호 순서 (Medium)
4. 서술문 일관성 (Medium)
5. 누락 (Low - 이미 이전 단계에서 확인)

**Q9-2**: "페이지가 정상 작성"의 의미:
- 페이지 번호가 연속적인가?
- 모든 섹션이 포함되었는가?
- 다른 의미?

**Q9-3**: 표 번호 검증 로직:
```
표1, 표2, 표3... 순서대로 있는지
표가 삭제된 경우 번호 재정렬했는지
```
이 로직이 자동으로 수정도 해주는가? 아니면 사용자에게 알림만?

### 권장 조치

QC 검증 항목별 상세 로직 정의

---

## 🟢 10. [Low] Stage 9 - 출력 형식 (Draft vs Final)

### 문제점

**워크플로우**: Draft 출력만 언급
```markdown
'출력' 버튼을 눌러서 워드화일로 Draft 버전 출력.
문서 뒤에 '_Draft'라고 명기
```

**제작 사양서**: Draft/Final 구분
```markdown
**파일명 형식**:
- Draft: `{보고서명}_Draft_{YYMMDD}.docx`
- Final: `{보고서명}_Final_{YYMMDD}.docx`
```

### 협의 필요 사항

**Q10-1**: Draft vs Final 차이:
- 워터마크만 다른가?
- 내용 차이도 있는가?

**Q10-2**: Final 출력 시점:
- QC 통과 후 자동으로 Final?
- 사용자가 명시적으로 "Final 출력" 선택?

**Q10-3**: 전자서명 영역:
```markdown
- [ ] 전자서명 영역 (선택)
```
전자서명이 실제로 필요한가?

### 권장 조치

Draft/Final 구분 명확화

---

## 🔴 11. [High] 저장 위치 불일치 (로컬 vs 클라우드)

### 문제점

**워크플로우**: 로컬 저장 경로 명시
```markdown
- 저장 경로는 '04_MainProcess/02_RawData_MD/`
- 저장경로: `03_ExtractedData_MD`
- 파일: `02_Context/05_DialogWithLLM/{보고서명}_YYMMDD_hhmmss.md`
```

**제작 사양서**: Supabase Storage 사용
```markdown
- DB: `markdown_documents` 테이블
- Storage: `markdown` 버킷 (백업)
```

### 협의 필요 사항

**Q11-1**: 배포 방식이 GitHub Pages + Supabase인데, 로컬 저장이 가능한가?
- ❌ 브라우저에서는 로컬 파일 시스템 접근 불가
- ✅ Supabase Storage만 사용해야 함

**Q11-2**: 워크플로우의 로컬 경로는:
- ✅ **해석 A**: 개발/테스트 환경용 (실제 배포에서는 Supabase 사용)
- ❌ **해석 B**: 실제 운영 환경 (워크플로우가 잘못됨)

**Q11-3**: 파일 저장 정책:
```
DB (필수) + Storage (백업)
또는
Storage (필수) + DB (메타데이터만)
```
어느 쪽이 정확한가?

### 권장 조치

1. ⚠️ **매우 중요**: 저장 위치 통일 필요
2. 워크플로우 문서 업데이트
3. 로컬 경로는 테스트 모드 전용으로 명시

---

## 🟡 12. [Medium] LLM 대화 로그 저장 중복

### 문제점

**워크플로우**:
```markdown
LLM에게 보내는 컨택스트와 LLM으로 응답받는 컨텍스트를
'02_Context/05_DialogWithLLM'에 '보고서명_YYMMDD_hhmmss'파일명으로 저장.
```

**제작 사양서**:
```markdown
**저장 위치**:
- DB: `llm_dialogs` 테이블
- 파일: `02_Context/05_DialogWithLLM/{보고서명}_YYMMDD_hhmmss.md`
```

### 협의 필요 사항

**Q12-1**: 로그를 DB와 파일 양쪽에 저장하는가?
- ✅ 양쪽 모두 저장
- ❌ DB만 저장 (파일은 테스트용)
- ❓ 사용자 선택

**Q12-2**: 파일 저장은 위 Q11-1과 동일한 문제:
- 브라우저에서 로컬 파일 저장 불가
- Supabase Storage 사용해야 함

**Q12-3**: 로그 저장 목적:
- 디버깅?
- 감사(Audit)?
- 재현(Replay)?

### 권장 조치

로그 저장 정책 명확화

---

## 🟢 13. [Low] 로그인 실패 처리

### 문제점

**제작 사양서**:
```markdown
**FR-1.4: 로그인 실패 처리**
- 3회 실패 시 5분간 계정 잠금
```

**워크플로우**: 언급 없음

### 협의 필요 사항

**Q13-1**: 계정 잠금이 실제로 필요한가?
- 내부 사용자만 사용하는 시스템이라면 과도할 수 있음

**Q13-2**: 잠금 해제:
- 5분 자동 해제?
- Master가 수동 해제?

**Q13-3**: IP 기반 차단:
```markdown
- ✅ IP 기반 차단 (선택)
```
실제로 구현할 것인가?

### 권장 조치

보안 정책 검토 후 결정

---

# 추가 확인 필요 사항

## A. 템플릿 파일 존재 여부

다음 파일들이 실제로 존재하는지 확인 필요:

```
03_Template/02_Sections/
├── 00_표지.md
├── 01_목차.md
├── 02_약어설명.md
├── 03_서론.md
├── 04_전세계판매허가현황.md
├── 05_안전성조치.md
├── 06_안전성정보참고정보변경.md
├── 07_환자노출.md
├── 08_개별증례병력.md
├── 09_시험.md
├── 10_기타정보.md
├── 11_종합적인안전성평가.md
├── 12_결론.md
├── 13_참고문헌.md
└── 14_별첨.md
```

## B. 데이터 정의 파일 검증

다음 파일들의 내용이 사양서와 일치하는지 확인:

```
01_Context/
├── 0111_CSData_Definition.md (CS 60개 변수)
├── 0112_PHData_Definition.md (PH 9개 변수)
├── 0113_TableData_Definition.md (Table 7개 변수)
├── 0114_CS_from_Source.md (RAW ID → CS 매핑)
├── 0115_CS_to_Sections.md (CS → 섹션 매핑)
└── 0116_Source_CS_Sections.md (전체 데이터 흐름)
```

## C. Edge Functions 구현 확인

다음 Edge Functions의 구체적인 프롬프트 및 응답 형식 확인:

```
supabase/functions/
├── classify-raw-id/
├── convert-to-markdown/
├── extract-data/
└── qc-validation/
```

---

# 우선순위별 조치 계획

## 🔴 High Priority (즉시 해결 필요)

1. **Q1**: Stage 2 사용자 입력 정보 확정
2. **Q2**: RAW ID 필수/선택 구분 명확화
3. **Q4**: 데이터 충돌 해결 정책 수립
4. **Q8**: QC 모델 선택 확정
5. **Q11**: 저장 위치 통일 (로컬 vs 클라우드)

## 🟡 Medium Priority (개발 전 해결)

6. **Q3**: 파일 크기/타임아웃 제한 결정
7. **Q5**: 템플릿 파일 확인
8. **Q6**: 목차/약어 자동 생성 로직 설계
9. **Q9**: QC 검증 항목 우선순위 정립
10. **Q12**: LLM 로그 저장 정책 결정

## 🟢 Low Priority (개발 중 결정 가능)

11. **Q7**: 리뷰 권한 세분화
12. **Q10**: Draft/Final 구분 명확화
13. **Q13**: 로그인 보안 정책 검토

---

# 제안: 다음 단계

## 1단계: 즉시 협의 (오늘)

High Priority 5개 항목 결정:
- Q1, Q2, Q4, Q8, Q11

## 2단계: 문서 업데이트 (1-2일)

- 워크플로우 문서 업데이트
- 제작 사양서 수정
- 불일치 제거

## 3단계: 파일 검증 (1일)

- 템플릿 파일 존재 확인
- 데이터 정의 파일 검증
- 샘플 데이터로 테스트

## 4단계: 개발 시작

모든 불명확한 사항 해결 후 개발 시작

---

**문서 끝**
